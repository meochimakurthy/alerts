<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEO Chimakurthy Portal</title>
    <style>
        :root { --p: #0056b3; --a: #ffcc00; --g1: #bbbbbb; --g2: #d9d9d9; --light-blue: #e2f0fe; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #fff; }
        
        /* 1. HEADER LAYOUT */
        .header-table { width: 100%; border-collapse: collapse; text-align: center; table-layout: fixed; }
        .header-table td { border: 1px solid #999; padding: 5px; font-weight: bold; font-size: 0.75rem; vertical-align: middle; }
        .row-1 { background: var(--g1); height: 40px; font-size: 0.9rem !important; }
        .row-2 { background: var(--g2); height: 35px; font-size: 0.85rem !important; }
        
        /* Matching Blue for CM and Minister */
        .c-blue { background: var(--light-blue); }
        .c-act { background: #3b82f6; color: white; }
        
        .off-img { width: 85px; height: 105px; object-fit: cover; background: #ccc; border: 1px solid #999; display: block; margin: 5px auto; }

        /* 2. NAVIGATION & DROPDOWNS */
        .nav-bar { display: flex; background: #000; color: white; position: relative; z-index: 9999; }
        .nav-item { flex: 1; padding: 15px 5px; text-align: center; cursor: pointer; font-size: 0.8rem; border-right: 1px solid #333; position: relative; }
        .nav-item:hover { background: #333; color: var(--a); }
        .drop { display: none; position: absolute; top: 100%; left: 0; width: 220px; background: white; color: #333; list-style: none; padding: 0; margin: 0; text-align: left; box-shadow: 0 4px 10px rgba(0,0,0,0.2); border-top: 3px solid var(--p); }
        .nav-item:hover .drop { display: block; }
        .drop li a { display: block; padding: 10px; text-decoration: none; color: #333; border-bottom: 1px solid #eee; font-size: 0.75rem; }

        /* 3. ALERTS & CONTENT */
        .alert-bg { background: #c6e0b4; padding: 10px; overflow: hidden; white-space: nowrap; border-bottom: 2px solid #555; font-weight: bold; }
        .marquee { display: inline-block; animation: h-scroll 25s linear infinite; }

        /* 4. THREE-PART PHOTO SECTION */
        .photo-section-grid { 
            background: #adb9ca; 
            padding: 20px; 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 15px; 
            border-bottom: 1px solid #555;
        }
        .photo-box { 
            height: 250px; 
            background: #000; 
            border: 2px solid #fff; 
            overflow: hidden; 
            position: relative;
        }
        .photo-box img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; /* Auto-fit to fill the box */
            display: block;
        }

        /* 5. TASKS */
        .task-bg { background: #fce4d6; padding: 15px; border-top: 2px solid #555; font-weight: bold; }
        .task-win { height: 120px; overflow: hidden; position: relative; margin-top: 5px; }
        .task-list { position: absolute; width: 100%; animation: v-scroll 15s linear infinite; }
        
        @keyframes h-scroll { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }
        @keyframes v-scroll { 0% { top: 100%; } 100% { top: -100%; } }
        .blink { animation: blink 1s step-start infinite; color: red; }
        @keyframes blink { 50% { opacity: 0; } }
    </style>
</head>
<body>

<table class="header-table">
    <tr class="row-1"><td colspan="5">Samagra Shiksha, Andhra Pradesh</td></tr>
    <tr class="row-2"><td colspan="5">MANDAL EDUCATIONAL OFFICER, CHIMAKURTHY MANDAL OFFICIAL PORTAL</td></tr>
    <tr>
        <td rowspan="3" class="c-blue">Honorable Chief Minister of Andhra Pradesh<br><img id="img-CM" class="off-img"><span id="txt-CM">...</span></td>
        <td class="c-act">Mandal Educational Officer-1</td>
        <td rowspan="3"><img id="img-Symbol" src="" style="width:60px; display:block; margin:auto;"></td>
        <td class="c-act">Mandal Educational Officer-2</td>
        <td rowspan="3" class="c-blue">Honorable Education Minister of Andhra Pradesh<br><img id="img-Minister" class="off-img"><span id="txt-Minister">...</span></td>
    </tr>
    <tr><td><img id="img-MEO1" class="off-img"></td><td><img id="img-MEO2" class="off-img"></td></tr>
    <tr class="c-act"><td id="txt-MEO1">...</td><td id="txt-MEO2">...</td></tr>
</table>

<div class="nav-bar">
    <div class="nav-item">HOME</div>
    <div class="nav-item">CONTACT<ul class="drop" id="d-Contact"></ul></div>
    <div class="nav-item">IMPORTANT LINKS<ul class="drop" id="d-Importantlinks"></ul></div>
    <div class="nav-item">UDISE<ul class="drop" id="d-UDISE"></ul></div>
    <div class="nav-item">STATISTICS<ul class="drop" id="d-Statistics"></ul></div>
    <div class="nav-item">DOWNLOADS<ul class="drop" id="d-Downloads"></ul></div>
    <div class="nav-item">HM LOGIN<ul class="drop" id="d-HMLogin"></ul></div>
</div>

<div class="alert-bg"><div class="marquee" id="alert-box">Loading Data...</div></div>

<div class="photo-section-grid">
    <div class="photo-box"><img id="center-p1" src=""></div>
    <div class="photo-box"><img id="center-p2" src=""></div>
    <div class="photo-box"><img id="center-p3" src=""></div>
</div>

<div class="task-bg">Running Tasks:<div class="task-win"><div class="task-list" id="task-box"></div></div></div>

<script>
    const S_ID = '1TVWIHBrWDw0lflCmooFEhYcCfQenM8mAVRHSYt_bFZ4';
    const G_URL = `https://docs.google.com/spreadsheets/d/${S_ID}/gviz/tq?tqx=out:json`;

    async function start() {
        try {
            const res = await fetch(G_URL);
            const text = await res.text();
            const json = JSON.parse(text.substr(47).slice(0, -2));
            const db = json.table.rows;
            const clean = (str) => str ? str.toString().toLowerCase().replace(/\s+/g, '') : '';

            // 1. OFFICIALS & SYMBOL
            ['CM', 'Minister', 'MEO1', 'MEO2', 'Symbol'].forEach(cat => {
                const r = db.find(x => clean(x.c[0]?.v) === clean(cat));
                if(r) {
                    if(cat !== 'Symbol') document.getElementById('txt-'+cat).innerText = r.c[1]?.v || '';
                    const img = document.getElementById('img-'+cat);
                    let url = r.c[2]?.v || '';
                    if(url.includes('drive.google.com')){
                        const id = url.split('id=')[1] || url.split('/d/')[1].split('/')[0];
                        url = `https://drive.google.com/uc?export=view&id=${id}`;
                    }
                    if(url) img.src = url;
                }
            });

            // 2. CENTER PHOTOS (Box 1, 2, 3)
            ['CenterPhoto1', 'CenterPhoto2', 'CenterPhoto3'].forEach((cat, index) => {
                const r = db.find(x => clean(x.c[0]?.v) === clean(cat));
                const img = document.getElementById('center-p' + (index + 1));
                if(r && r.c[2]?.v) {
                    let url = r.c[2].v;
                    if(url.includes('drive.google.com')){
                        const id = url.split('id=')[1] || url.split('/d/')[1].split('/')[0];
                        url = `https://drive.google.com/uc?export=view&id=${id}`;
                    }
                    img.src = url;
                }
            });

            // 3. DROPDOWNS
            const menuCats = ['Contact', 'Importantlinks', 'UDISE', 'Statistics', 'Downloads', 'HMLogin'];
            menuCats.forEach(mc => {
                const items = db.filter(x => clean(x.c[0]?.v) === mc.toLowerCase());
                const drop = document.getElementById('d-' + mc);
                if(drop) drop.innerHTML = items.map(i => `<li><a href="${i.c[2]?.v || '#'}" target="_blank">${i.c[1]?.v || 'No Label'}</a></li>`).join('');
            });

            // 4. ALERTS
            const alerts = db.filter(x => clean(x.c[0]?.v) === 'latestalert');
            document.getElementById('alert-box').innerHTML = alerts.map(x => `<span class="blink">NEW:</span> ${x.c[1]?.v}`).join('   |   ');

            // 5. TASKS
            const tasks = db.filter(x => clean(x.c[0]?.v) === 'currentrunningtasks');
            document.getElementById('task-box').innerHTML = tasks.map(x => `<div style="padding:10px; border-bottom:1px solid #ddd;">➔ ${x.c[1]?.v}</div>`).join('');

        } catch (e) { console.error("Sync Error:", e); }
    }
    start();
</script>
</body>
</html>
